<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Client (Phase 2)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    #log { border: 1px solid #ccc; padding: 10px; height: 320px; overflow-y: auto; border-radius: 8px; }
    input, button { padding: 8px; margin: 4px 0; }
    .row { display: flex; gap: 8px; }
    .row input { flex: 1; }
  </style>
</head>
<body>
  <h1>Chat Client (Phase 2)</h1>
  <p>1. Register/Login â†’ get JWT token.<br>
     2. Paste it below â†’ connect to a room.<br>
     3. Chat in real-time ðŸŽ‰</p>

  <div>
    <label>Server (ws):</label>
    <input id="server" value="ws://127.0.0.1:8000" />
  </div>
  <div>
    <label>Room:</label>
    <input id="room" placeholder="general" />
  </div>
  <div>
    <label>JWT Token:</label>
    <input id="token" placeholder="paste your access_token here" />
  </div>
  <div class="row">
    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn" disabled>Disconnect</button>
  </div>

  <div id="log"></div>

  <div class="row">
    <input id="message" placeholder="Type message..." />
    <button id="sendBtn" disabled>Send</button>
  </div>

  <script>
    let ws = null;
    const log = (m) => {
      const div = document.getElementById('log');
      const p = document.createElement('div');
      p.textContent = m;
      div.appendChild(p);
      div.scrollTop = div.scrollHeight;
    };

    document.getElementById('connectBtn').onclick = () => {
      const server = document.getElementById('server').value;
      const room = document.getElementById('room').value || "general";
      const token = document.getElementById('token').value;
      if (!token) { alert("Token required. Login/Register first."); return; }
      const url = `${server}/ws/${encodeURIComponent(room)}?token=${encodeURIComponent(token)}`;
      ws = new WebSocket(url);
      ws.onopen = () => {
        log("[connected]");
        document.getElementById('sendBtn').disabled = false;
        document.getElementById('disconnectBtn').disabled = false;
      };
      ws.onmessage = (ev) => log(ev.data);
      ws.onclose = () => {
        log("[disconnected]");
        document.getElementById('sendBtn').disabled = true;
        document.getElementById('disconnectBtn').disabled = true;
      };
      ws.onerror = () => log("[error]");
    };

    document.getElementById('disconnectBtn').onclick = () => {
      if (ws) ws.close();
    };

    document.getElementById('sendBtn').onclick = () => {
      const msg = document.getElementById('message').value;
      if (ws && msg) ws.send(msg);
      document.getElementById('message').value = '';
    };
  </script>
</body>
</html>
